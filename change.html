<!DOCTYPE html>
<html>

<head>
    <title>Change</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" style="text/css" href="change.css" />
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-121084620-1"></script>
</head>
<script>
// Initialize Firebase
var config = {
    apiKey: "AIzaSyBqaB_5x6WNZiU5RoSZ4aveLmuMgfs0m_0",
    authDomain: "viban-44f1e.firebaseapp.com",
    databaseURL: "https://viban-44f1e.firebaseio.com",
    projectId: "viban-44f1e",
    storageBucket: "viban-44f1e.appspot.com",
    messagingSenderId: "150917914821"
};
firebase.initializeApp(config);
var dbRef = firebase.database();
var compound = false;
//先把uid 儲存起來 之後都可以用
// var currentUserId = "2genxkG8K0bMF3LryCWaN8EQVyA3";

//進行註冊
firebase.auth().onAuthStateChanged(function(user) {
    console.log(user);
    if (user) {
        currentUserId = user.uid;
        console.log(currentUserId);
        dbRef.ref("/" + currentUserId).on('value', function(snapshot) {
            var rubyamount = snapshot.val().ruby;
            console.log(rubyamount);
            $(".ruby").append("<p>目前已挖到" + rubyAmount + "顆寶石</p>");
        });
    }

});

function cozy() {
    compound = true;
    dbRef.ref("/" + currentUserId).on('value', function(snapshot) {
        var rubyamount = snapshot.val().ruby;
        var cozyamount = snapshot.val().cozy;
        console.log(rubyamount);
        dbRef.ref(currentUserId).update({
            cozy: cozyamount + 1,
            ruby: rubyamount - 10

        });
    });
    compound = false;
}

function dragon() {
    compound = true;
    dbRef.ref("/" + currentUserId).on('value', function(snapshot) {
        var rubyamount = snapshot.val().ruby;
        var dragonamount = snapshot.val().dragon;
        console.log(rubyamount);
        dbRef.ref(currentUserId).update({
            cozy: dragonamount + 1,
            ruby: rubyamount - 10

        });
    });
    compound = false;
}

function deme() {
    compound = true;
    dbRef.ref("/" + currentUserId).on('value', function(snapshot) {
        var rubyamount = snapshot.val().ruby;
        var demeamount = snapshot.val().deme;
        console.log(rubyamount);
        dbRef.ref(currentUserId).update({
            deme: cozyamount + 1,
            ruby: rubyamount - 10

        });
    });
    compound = false;
}
//     $(document).ready(function(){

//         $(".showRuby").on("click", function(){
//             console.log("ENTER");
//             dbRef.ref("/"+currentUserId).on('value', function(snapshot) {
//                 var rubyamount=snapshot.val().ruby; 
//                 $(".myRubyValue").text(rubyamount);
//             });
//         });
//     });
</script>

<body>
    <div class="contain">
        <div class="ruby"></div>
        <button type="button" class="btn btn-info btn-lg" id="home" onclick="window.location.href='index.html'">回首頁</button>
        <div class="ruby1">
            <img src="ruby.png">
        </div>
        <p id="amount1">10*</p>
        <div class="ruby2">
            <img src="ruby.png">
        </div>
        <p id="amount2">10*</p>
        <div class="ruby3">
            <img src="ruby.png">
        </div>
        <p id="amount3">10*</p>
        <button type="button" class="btn btn-info btn-lg" id="change1" onclick="deme()"><a href="./deme.html">合成優惠券</button>
    </div>
    <button type="button" class="btn btn-info btn-lg" id="change2" onclick="cozy()"><a href="./cozy.html">合成優惠券</button>
    </div>
    <button type="button" class="btn btn-info btn-lg" id="change3"  onclick="dragon()"><a href="./dragon.html">合成優惠券</button>
    </div>

  

</body>
</html>