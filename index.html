<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Google Web Fonts -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Stylesheet CSS -->
    <link rel='stylesheet' href='stylesheets/index.css' />
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <!--   <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script> -->
    <script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!--firebase-->
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <title>
        viban
    </title>
</head>

<body>
    <!-- background -->
    <div class="bg">
        <img src="stylesheets/img/lab.jpg">
    </div>
    <!-- modal -->
    <div class="modal" tabindex="-1" role="dialog" id="myModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">遊戲教學</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h5>歡迎來到喬伊的實驗室!</h5> 你的任務就是替喬伊收集城市地底的礦石，幫助他完成合成機器人的夢想。
                    <br>喬伊已經在各個路口設置礦物雷達，當你拿著手機實際走到路口的紅綠燈時，將會收到礦物雷達發出的採礦任務通知。
                    <br>收到通知後，即可開始採礦任務收集礦石。
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="nextPage">下一頁</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" id="nextModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">遊戲教學</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h6>但切記，手機發出的亮光會驚醒礦坑裡沉睡的蝙蝠，所以請務必將手機保持在採礦模式，否則辛苦收集到的礦石將全部遺失！</h6>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="goMining"><a href="./dig.html" style="color: #000000">挖礦去!！</a></button>
                </div>
            </div>
        </div>
    </div>
    <!-- circle nav menu -->
    <div class="container-fluid">
        <nav id="circle-nav-wrapper" class="circle-nav-wrapper">
            <div class="circle-nav-toggle"><i class="material-icons">camera</i></div>
            <div class="circle-nav-panel"></div>
            <ul class="circle-nav-menu">
                <li class="circle-nav-item circle-nav-item-1"><a href="#"><i class="material-icons">home</i><span>Lab</span></a></li>
                <li class="circle-nav-item circle-nav-item-2"><a href="./ingredients.html"><i class="material-icons">memory</i><span>Ingredients</span></a></li>
                <li class="circle-nav-item circle-nav-item-3"><a href="./robots.html"><i class="material-icons">adb</i><span>Robots</span></a></li>
                <li class="circle-nav-item circle-nav-item-4"><a href="./googlemap.html"><i class="material-icons">place</i><span>Map</span></a></li>
                <li class="circle-nav-item circle-nav-item-5"><a href="#"><i class="material-icons">loyalty</i><span>Coupon</span></a></li>
            </ul>
        </nav>
    </div>
    <script>
    //circle nav wrapper
    ! function(e, o, l, c) {
        e.fn.circleNav = function(o) {
            var l = e.extend({}, e.fn.circleNav.settings, o);
            return this.each(function() {
                var o = e(this),
                    c = e(".circle-nav-toggle"),
                    n = e(".circle-nav-panel"),
                    a = e(".circle-nav-menu");
                l.overlay && 0 == e(".circle-nav-overlay").length && (e("body").append("<div class='circle-nav-overlay'></div>"), e(".circle-nav-overlay").css({ top: "0", right: "0", bottom: "0", left: "0", position: "fixed", "background-color": l.overlayColor, opacity: l.overlayOpacity, "z-index": "-1", display: "none" })), e(".circle-nav-toggle, .circle-nav-overlay").on("click", function() { o.stop().toggleClass("circle-nav-open"), c.stop().toggleClass("circle-nav-open"), n.stop().toggleClass("circle-nav-open"), a.stop().toggleClass("circle-nav-open"), e(".circle-nav-overlay").fadeToggle(), e("body").css("overflow") ? e("body, html").css("overflow", "") : e("body, html").css("overflow", "hidden") })
            })
        }, e.fn.circleNav.settings = { overlay: !0, overlayColor: "#fff", overlayOpacity: ".7" }
    }(jQuery, window, document);
    $(function() { $("#circle-nav-wrapper").circleNav() });

    //show modal 
    $('#myModal').modal('show');
    document.getElementById("nextPage").onclick = function() { changeModal() }

    function changeModal() {
        $('#myModal').modal('hide');
        $('#nextModal').modal('show');
    }



    //set notification
    // const messaging = firebase.messaging();

    // messaging.onTokenRefresh(function() {
    //     messaging.getToken()
    //         .then(function(refreshedToken) {
    //             console.log('Token refreshed.', refreshedToken);
    //         })
    //         .catch(function(err) {
    //             console.log('Unable to retrieve refreshed token ', err);
    //         });
    // });

    // messaging.onMessage(function(payload) {
    //     console.log("Message received. ", payload);
    // });

    // messaging.requestPermission()
    //     .then(function() {
    //         console.log('Notification permission granted.');
    //         resetUI();
    //     })
    //     .catch(function(err) {
    //         console.log('Unable to get permission to notify.', err);
    //     });

    // function resetUI() {
    //     console.log('resetUI');
    //     messaging.getToken()
    //         .then(function(currentToken) {
    //             if (currentToken) {
    //                 console.log("currentToken:", currentToken);
    //             } else {
    //                 console.log('No Instance ID token available. Request permission to generate one.');
    //             }
    //         })
    //         .catch(function(err) {
    //             console.log('An error occurred while retrieving token. ', err);
    //         });
    // }

    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyBqaB_5x6WNZiU5RoSZ4aveLmuMgfs0m_0",
        authDomain: "viban-44f1e.firebaseapp.com",
        databaseURL: "https://viban-44f1e.firebaseio.com",
        projectId: "viban-44f1e",
        storageBucket: "viban-44f1e.appspot.com",
        messagingSenderId: "150917914821"
    };
    firebase.initializeApp(config);

    var dbRef = firebase.database();
    var statusRef = dbRef.ref('viban/status');

    // switch pages
    statusRef.on("value", function(snapshot) {
        console.log(snapshot.val());
        switch (snapshot.val()) {
            case 0: //首頁
                document.location.href = "#";
                break;
            case 1: //挖礦中
                document.location.href = "https://103306079.github.io/viban/dig.html";
                break;
            case 2: //過馬路任務結束(成功)
                document.location.href = "https://103306079.github.io/viban/end.html";
                break;
            case 3: //過馬路任務失敗
                document.location.href = "https://103306079.github.io/viban/failed.html";
                break;
            case 4: //bonus任務成功
                document.location.href = "https://103306079.github.io/viban/endbonus.html";
                break;
            case 5: //bonus任務失敗
                document.location.href = "https://103306079.github.io/viban/continuefail.html";
                break;
            default:
                document.location.href = "https://103306079.github.io/viban/index.html";
        }
    }, function(error) {
        console.log("Error: " + error.code);
    });
    </script>
</body>

</html>