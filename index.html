<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Google Web Fonts -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Stylesheet CSS -->
    <link rel='stylesheet' href='stylesheets/index.css' />
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <!--   <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script> -->
    <script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!--firebase-->
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <title>
        viban
    </title>
</head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-121084620-1"></script>
<script>
//GA
window.dataLayer = window.dataLayer || [];

function gtag() { dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-121084620-1');


// Initialize Firebase
var config = {
    apiKey: "AIzaSyBqaB_5x6WNZiU5RoSZ4aveLmuMgfs0m_0",
    authDomain: "viban-44f1e.firebaseapp.com",
    databaseURL: "https://viban-44f1e.firebaseio.com",
    projectId: "viban-44f1e",
    storageBucket: "viban-44f1e.appspot.com",
    messagingSenderId: "150917914821"
};
firebase.initializeApp(config);

var dbRef = firebase.database();
var playerRef = dbRef.ref('viban');
//     player.on('value').then(function(snapshot) {
//     var name = snapshot.val().name;
//   // ...
// });
var decodedCookie = decodeURIComponent(document.cookie);
console.log(decodedCookie);
//     function _uuid() {
//   function s4() {
//     return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
//   }
//   return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
// }

// var uuid = _uuid();
// function addFunction() {
playerRef.once('value').then(function(snapshot) {
    snapshot.forEach(function(childSnapshot) {
        if (childSnapshot.val().name == decodedCookie) {
            childSnapshot.key.push({
                name: decodedCookie,
                ruby: 10,
                time: 3,
                coupon: 4
            });
            console.log(123);
        } else {
            var current = playerRef.push({
                name: decodedCookie,
                ruby: 1,
                time: 1,
                coupon: 1
            });
        }
    });
})
//}

// playerRef.once('value').then(function(snapshot) {
//     snapshot.forEach(function(childSnapshot) {
//         console.log(childSnapshot.key);
//         console.log(childSnapshot.val().name);
//     });
// })
</script>

<body>
    <!-- background -->
    <div class="bg">
        <img src="stylesheets/img/lab.jpg">
    </div>
    <!-- modal -->
    <div class="modal" tabindex="-1" role="dialog" id="myModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">遊戲教學</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h5>歡迎來到喬伊的實驗室!</h5>
                    <p>科學家喬伊在這座城市地底下發現許多珍貴的礦石， 而你的任務就是替喬伊收集地底的礦石，幫助他完成合成機器人的夢想。
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="nextPage1">下一頁</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" id="nextModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">遊戲教學</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>按下開始挖礦並行走，便能開啟挖礦任務。此時請務必將手機保持在挖礦模式，不必看著手機，收進口袋便能自動開採礦石。
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="nextPage2">下一頁</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" id="thirdModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">遊戲教學</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>切記，若行走同時<span style="color: red">看了</span>手機，辛苦收集到的礦石將全部遺失！
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="nextPage3">下一頁</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" id="lastModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">遊戲教學</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>只要遵守採礦守則，走得越久能蒐集到越多喔!
                        <br>在馬路口進行挖礦，還有快速挖礦模式，只要不看手機，便可以得到稀有的礦石！
                        <br>準備好去挖礦了嗎？</p>
                    </p>
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="goMining" onclick="addFunction()"><a href="./start.html" style="color: #000000">開始挖礦</a></button>
                </div>
            </div>
        </div>
    </div>
    <!-- circle nav menu -->
    <div class="container-fluid">
        <nav id="circle-nav-wrapper" class="circle-nav-wrapper">
            <div class="circle-nav-toggle"><i class="material-icons">camera</i></div>
            <div class="circle-nav-panel"></div>
            <ul class="circle-nav-menu">
                <li class="circle-nav-item circle-nav-item-1"><a href="#"><i class="material-icons">home</i><span>Lab</span></a></li>
                <li class="circle-nav-item circle-nav-item-2"><a href="./ingredients.html"><i class="material-icons">memory</i><span>Ingredients</span></a></li>
                <li class="circle-nav-item circle-nav-item-3"><a href="./robots.html"><i class="material-icons">adb</i><span>Robots</span></a></li>
                <li class="circle-nav-item circle-nav-item-4"><a href="./googlemap.html"><i class="material-icons">place</i><span>Map</span></a></li>
                <li class="circle-nav-item circle-nav-item-5"><a href="#"><i class="material-icons">loyalty</i><span>Coupon</span></a></li>
            </ul>
        </nav>
    </div>
    <script>
    //circle nav wrapper
    ! function(e, o, l, c) {
        e.fn.circleNav = function(o) {
            var l = e.extend({}, e.fn.circleNav.settings, o);
            return this.each(function() {
                var o = e(this),
                    c = e(".circle-nav-toggle"),
                    n = e(".circle-nav-panel"),
                    a = e(".circle-nav-menu");
                l.overlay && 0 == e(".circle-nav-overlay").length && (e("body").append("<div class='circle-nav-overlay'></div>"), e(".circle-nav-overlay").css({ top: "0", right: "0", bottom: "0", left: "0", position: "fixed", "background-color": l.overlayColor, opacity: l.overlayOpacity, "z-index": "-1", display: "none" })), e(".circle-nav-toggle, .circle-nav-overlay").on("click", function() { o.stop().toggleClass("circle-nav-open"), c.stop().toggleClass("circle-nav-open"), n.stop().toggleClass("circle-nav-open"), a.stop().toggleClass("circle-nav-open"), e(".circle-nav-overlay").fadeToggle(), e("body").css("overflow") ? e("body, html").css("overflow", "") : e("body, html").css("overflow", "hidden") })
            })
        }, e.fn.circleNav.settings = { overlay: !0, overlayColor: "#fff", overlayOpacity: ".7" }
    }(jQuery, window, document);
    $(function() { $("#circle-nav-wrapper").circleNav() });

    //show modal 
    $('#myModal').modal('show');
    document.getElementById("nextPage1").onclick = function() { changeModal1() }
    document.getElementById("nextPage2").onclick = function() { changeModal2() }
    document.getElementById("nextPage3").onclick = function() { changeModal3() }

    function changeModal1() {
        $('#myModal').modal('hide');
        $('#nextModal').modal('show');
    }

    function changeModal2() {
        $('#nextModal').modal('hide');
        $('#thirdModal').modal('show');
    }

    function changeModal3() {
        $('#thirdModal').modal('hide');
        $('#lastModal').modal('show');
    }

    // document.getElementById("goMining").onclick = function() { timeDuration() }



    //set notification
    // const messaging = firebase.messaging();

    // messaging.onTokenRefresh(function() {
    //     messaging.getToken()
    //         .then(function(refreshedToken) {
    //             console.log('Token refreshed.', refreshedToken);
    //         })
    //         .catch(function(err) {
    //             console.log('Unable to retrieve refreshed token ', err);
    //         });
    // });

    // messaging.onMessage(function(payload) {
    //     console.log("Message received. ", payload);
    // });

    // messaging.requestPermission()
    //     .then(function() {
    //         console.log('Notification permission granted.');
    //         resetUI();
    //     })
    //     .catch(function(err) {
    //         console.log('Unable to get permission to notify.', err);
    //     });

    // function resetUI() {
    //     console.log('resetUI');
    //     messaging.getToken()
    //         .then(function(currentToken) {
    //             if (currentToken) {
    //                 console.log("currentToken:", currentToken);
    //             } else {
    //                 console.log('No Instance ID token available. Request permission to generate one.');
    //             }
    //         })
    //         .catch(function(err) {
    //             console.log('An error occurred while retrieving token. ', err);
    //         });
    // }

    // Initialize Firebase
    // var config = {
    //     apiKey: "AIzaSyBqaB_5x6WNZiU5RoSZ4aveLmuMgfs0m_0",
    //     authDomain: "viban-44f1e.firebaseapp.com",
    //     databaseURL: "https://viban-44f1e.firebaseio.com",
    //     projectId: "viban-44f1e",
    //     storageBucket: "viban-44f1e.appspot.com",
    //     messagingSenderId: "150917914821"
    // };
    // firebase.initializeApp(config);

    // var dbRef = firebase.database();

    //     statusRef.on("value", function(snapshot) {
    //         console.log(snapshot.val());
    //         switch (snapshot.val()) {
    //             case 0: //start
    //                 document.location.href = "https://103306079.github.io/viban/start.html";
    //                 break;
    //             case 1: //digging
    //                 document.location.href = "https://103306079.github.io/viban/dig.html";
    //                 break;
    //             case 2: //side1 pause
    //                 document.location.href = "https://103306079.github.io/viban/side1.html";
    //                 break;
    //             case 3: //side1 fail
    //                 document.location.href = "https://103306079.github.io/viban/side1fail.html";
    //                 break;
    //             case 4: //road1 pause
    //                 document.location.href = "https://103306079.github.io/viban/road1.html";
    //                 break;
    //             case 5: //road1 fail
    //                 document.location.href = "https://103306079.github.io/viban/road1fail.html";
    //                 break;
    //             case 6: //side2 pause
    //                 document.location.href = "https://103306079.github.io/viban/side2.html";
    //                 break;
    //             case 7: //side2 fail
    //                 document.location.href = "https://103306079.github.io/viban/side2fail.html";
    //                 break;
    //             case 8: //road2 pause
    //                 document.location.href = "https://103306079.github.io/viban/road2.html";
    //                 break;
    //             case 9: //road2 fail
    //                 document.location.href = "https://103306079.github.io/viban/road2fail.html";
    //                 break;
    //             case 10: //side3 pause
    //                 document.location.href = "https://103306079.github.io/viban/side3.html";
    //                 break;
    //             case 11: //side3 fail
    //                 document.location.href = "https://103306079.github.io/viban/side3fail.html";
    //                 break;
    //             case 12: //road3 pause
    //                 document.location.href = "https://103306079.github.io/viban/road3.html";
    //                 break;
    //             case 13: //road3 fail
    //                 document.location.href = "https://103306079.github.io/viban/road3fail.html";
    //                 break;
    //             case 14: //side4 pause
    //                 document.location.href = "https://103306079.github.io/viban/side4.html";
    //                 break;
    //             case 15: //side4 fail
    //                 document.location.href = "https://103306079.github.io/viban/side4fail.html";
    //                 break;
    //             case 16: //road4 pause
    //                 document.location.href = "https://103306079.github.io/viban/road4.html";
    //                 break;
    //             case 17: //road4 fail
    //                 document.location.href = "https://103306079.github.io/viban/road4fail.html";
    //                 break;
    //             case 18: //side5 pause
    //                 document.location.href = "https://103306079.github.io/viban/side5.html";
    //                 break;
    //             case 19: //side5 fail
    //                 document.location.href = "https://103306079.github.io/viban/side5fail.html";
    //                 break;
    //             case 20: //road5 pause
    //                 document.location.href = "https://103306079.github.io/viban/road5.html";
    //                 break;
    //             case 21: //road5 fail
    //                 document.location.href = "https://103306079.github.io/viban/road5fail.html";
    //                 break;
    //             case 22: //success
    //                 document.location.href = "https://103306079.github.io/viban/road5com.html";
    //                 break;
    //             default:
    //                 document.location.href = "#";
    //         }
    //     }, function(error) {
    //         console.log("Error: " + error.code);
    //     });
    </script>
</body>

</html>