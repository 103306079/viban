<!DOCTYPE html>
<html>

<head>
    <title>Stop</title>
    <meta name="viewport" content="width=device-width; initial-scale=1.0">
    <link rel="stylesheet" style="text/css" href="stop.css" />
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!--firebase-->
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <!--Google Analytics-->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-121084620-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-121084620-1');
    </script>
</head>
<script>
// Initialize Firebase
var config = {
    apiKey: "AIzaSyBqaB_5x6WNZiU5RoSZ4aveLmuMgfs0m_0",
    authDomain: "viban-44f1e.firebaseapp.com",
    databaseURL: "https://viban-44f1e.firebaseio.com",
    projectId: "viban-44f1e",
    storageBucket: "viban-44f1e.appspot.com",
    messagingSenderId: "150917914821"
};
firebase.initializeApp(config);

var dbRef = firebase.database();
var timeRef = dbRef.ref('viban/time');
var digTimeRef = dbRef.ref('viban/digTime');


    if (window.DeviceOrientationEvent || window.DeviceMotionEvent) {
        window.addEventListener('deviceorientation', function(event) {

            var a = document.getElementById('alpha'),
                b = document.getElementById('beta'),
                g = document.getElementById('gamma')

            alpha = event.alpha,
                beta = event.beta,
                gamma = event.gamma;

            a.innerHTML = Math.round(alpha);
            b.innerHTML = Math.round(beta);
            g.innerHTML = Math.round(gamma);


            // look at phone
            // if (b.innerHTML >= 20 && b.innerHTML <= 90 && g.innerHTML >= 0 && g.innerHTML <= 10) {
            //     document.getElementById('sensor').append("現在狀態:看手機");
            // }

            window.addEventListener('devicemotion', function(event) {
                var accel = event.acceleration;
                if (accel.x > 1.5 || accel.y > 1.5 && b.innerHTML >= 20 && b.innerHTML <= 90 && g.innerHTML >= 0 && g.innerHTML <= 10) {
                    //$('.content').append('' + accel.x.toFixed(1) + ',' + accel.y.toFixed(1) + ',' + accel.z.toFixed(1) + '<br>');
                    counter++;
                    $('.sensor').append(counter);
                    // document.getElementById('sensor').append("現在狀態:看手機");

                    timeout = setTimeout(function() {
                        if (counter < 4) {
                            counter = 0;
                        }
                    }, 800);
                } else {
                        document.location.href = "https://103306079.github.io/viban/dig.html"

                }
                if (counter > 4) {
                    // $('.sensor').append('Magic 8 ball says: you rock!');
                    counter = 0;
                    clearInterval(timeout);
                }
            });

        }, false);
    } else {
        document.querySelector('body').innerHTML = '你的瀏覽器不支援喔';
    }

</script>

<body>
    <div class="contain">
        <div class="timeDuration" style="padding-left: 40%; padding-top: 18%;font-size: 15px">
        </div>
        <button type="button" id="dig" onclick="window.location.href='index.html'">合成寶石</button>
    </div>
    <script>
    var end = new Date().getTime();
    console.log(end);
    timeRef.on("value", function(snapshot) {
        console.log(snapshot.val());
        var timeDuration = end - snapshot.val();
        console.log(timeDuration)
        var Mins = Math.round(((timeDuration % 86400000) % 3600000) / 60000);
        console.log(Mins);
        $(".timeDuration").append("<p>目前已挖礦" + Mins + "分</p>");
        digTimeRef.set(Mins);
    })
    </script>
</body>

</html>